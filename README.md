# Системное программирование
# Лабораторная №1

## Задание №1
Изменить поведение ctime для файловой системы UFS, чтобы оно отражало время создания файла, а не время изменения записи о нём.

## Задание №2
Изменить поведение файловой системы UFS так, чтобы при установке sticky bit на файл, владелец не мог открывать файл на запись.

## Задание №3
Изменить поведение NFSv4 ACL для файловой системы UFS таким образом, чтобы при установке IMMUTABLE флага, операция завершалась с ошибкой EPERM

## Задание №4
Изменить работу псевдофайловой системы ProcFS так, чтобы в случае, если среди аргументов командной строки процесса есть подстрока "HIDE", в начале cmdline дополнительно выводилась строка "HIDDEN: ".

## Задание №5
Изменить работу псевдофайловой системы ProcFS так, чтобы если PID процесса оканчивается на 0, в качестве core file size limit выводилось значение "1024" при доступе через файл /proc/PID/rlimit.

## Задание №6
 Изменить ядро операционой системы так, чтобы при выполнении системного вызова rename(2) для файловой системы UFS происходило следующее.
Если в качестве const char *to указана строка, содержащая символы '/', файл, путь к которому содержится в *from переименовывался в файл, имя которого содержит символы '/'.

## Решения
 
[Пояснительная часть](https://drive.google.com/open?id=1LEcuj_wXQcZgvTqwqLnpxcuseFh7MsQl)

[Решение](https://drive.google.com/open?id=1Qdlsl5Q9C40UQ2xHSAXnrDvhJyeyNykI)



# Лабораторная №2
## Задание №1
Модифицировать подсистему GRE так, чтобы при создании нового туннеля, проверялось наличие файлов /etc/gre_dst_deny и /etc/gre_src_deny, и, в случае существования любого из них, запрещалось создание туннеля с соответствующими адресами назначения и источника

## Задание №2
Запретить установку MTU менее 1024.

## Задание №3
Модифицировать подсистему GRE так, чтобы ToS для всех GRE пакетов устанавливался из файла /etc/gre\_tos. При этом, пакет должен быть доставлен корректно.

## Задание №4
Зарегистрировать изменяемый sysctl oid. В случае, если его значение не равно нулю на этапе обработки принятого пакета (наверное, для этого можно использовать bpf :] ), отбрасывать все пакеты, не относящиеся к какому-либо существующему туннелю на основании IP адресов источника и назначения. Результат работы доказать с помощью утилиты tcpdump для нулевого и ненулевого значений oid.

## Задание №5
Во всех принятых IP пакетах с ICMP Echo request изменить dst IP на корректный мультикаст IP адрес и отправить их в сеть. Работу продемонстрировать с помощью tcpdump(1).

## Задание №6
Запретить fast forwarding для IP пакетов длинной более 1100 байт. В отчёт, кроме патча, включить необходимые для тестирования команды и их вывод

## Решения

[Пояснительная часть](https://drive.google.com/open?id=1NAInknDMStuSxzt8MMHs0plAPdKohsPp)

[Решение](https://drive.google.com/open?id=1pgBVWiMRiRvvlPUAdgJ9PUCMR_3J0KrP)


# Лабораторная №3

## Задание №1
Ознакомиться с анализом Kernel Crash Dump файлов. Организовать их сохранение, не используя средства ZFS. 
Модифицировав исходный код ядра, привести систему к состоянию panic() специально допущенной ошибкой в fifofs с сохранением Crash Dump файла. 
Выполнить "offline" анализ core файла и "on-line" анализ ядра с помощью kgdb, выяснить причину, доказать, что причина соответствует внесенным изменениям.

## Задание №2
 Написать модуль ядра, регистрирующий системный вызов, который принимает в качестве аргумента строку и возвращает количество гласных в ней. 
В точки входа и выхода из этого системного вызова устновить трейспойнты и продемонстрировать работу с ними с помощью утилиты dtrace. 
Необходимо в реальном времени показывать события входа и выхода из системного вызова и с частотой в 5 секунд выводить сводную статистику по (за время работы dtrace-скрипта):
1. Суммарному количеству переданных в системный вызов пустых строк.
2. Суммарному количеству четных кодов возврата.
3. Суммарному количеству нечетных кодов возврата.
4. Суммарному количеству успешных операций открытия любых файлов.
5. Суммарному количеству операций открытия любых файлов.

## Задание №3
Изучить способы realtime отладки ядра. 
Продемонстрировать изученные навыки отладки ядра в реальном времени ("on-line") выполнив отладку функции, отвечающей за прием ICMP пакета в реальном времени. Научиться получать из передаваемого в функцию mbuf адрес источника и подменять его в реальном времени. Продемонстрировать с помощью утилиты ping. Модифицировать исходные коды ядра для выполнения данного задания запрещено.

## Решения
[Решение](https://drive.google.com/open?id=1aYoZngCFF43eO-KAR5PhKOO13d37T4ZK)


